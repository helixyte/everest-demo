
<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Using everest applications &mdash; everest demo 1.0b2 documentation</title>
    
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-2.3.0/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-2.3.0/css/bootstrap-responsive.min.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '1.0b2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/js/jquery-1.9.1.min.js"></script>
    <script type="text/javascript" src="_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="_static/bootstrap-2.3.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="everest demo 1.0b2 documentation" href="index.html" />
    <link rel="next" title="Glossary of Terms" href="glossary.html" />
    <link rel="prev" title="Building everest applications" href="building.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body>
<div class="container">
  
  <div id="navbar" class="navbar navbar-fixed-top">
    <div class="navbar-inner">
      <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
      <button class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <a class="brand" href="index.html">everest demo</a>
      <span class="navbar-text pull-left"><b>1.0</b></span>

      <div class="nav-collapse">
        <ul class="nav">
          <li class="divider-vertical"></li>
          
            <li class="dropdown globaltoc-container">
  <a href="index.html"
     class="dropdown-toggle"
     data-toggle="dropdown">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
    ><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="building.html">Building <em>everest</em> applications</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Using <em>everest</em> applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary of Terms</a></li>
</ul>
</ul>
</li>
            <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"><ul>
<li><a class="reference internal" href="#">Using <em>everest</em> applications</a><ul>
<li><a class="reference internal" href="#querying-with-get">1. Querying with GET</a><ul>
<li><a class="reference internal" href="#the-collection-query-language-cql">The Collection Query Language (CQL)</a></li>
<li><a class="reference internal" href="#get-request-processing">GET request processing</a></li>
</ul>
</li>
<li><a class="reference internal" href="#customizing-representations">2. Customizing representations</a></li>
</ul>
</li>
</ul>
</ul>
</li>
          
          
            
  <li><a href="building.html"
         title="previous chapter">&laquo; Building <em>everest</em> applications</a></li>
  <li><a href="glossary.html"
         title="next chapter">Glossary of Terms &raquo;</a></li>
          
          
            <li>
  <a href="_sources/using.txt"
     rel="nofollow">Source</a></li>
          
        </ul>

        
          
<form class="navbar-search pull-right" style="margin-bottom:-3px;" action="search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
        
      </div>
    </div>
  </div>

  
  <div class="section" id="using-everest-applications">
<h1>Using <em>everest</em> applications<a class="headerlink" href="#using-everest-applications" title="Permalink to this headline">¶</a></h1>
<div class="section" id="querying-with-get">
<h2>1. Querying with GET<a class="headerlink" href="#querying-with-get" title="Permalink to this headline">¶</a></h2>
<div class="section" id="the-collection-query-language-cql">
<h3>The Collection Query Language (CQL)<a class="headerlink" href="#the-collection-query-language-cql" title="Permalink to this headline">¶</a></h3>
<p>One of the main features of the collection resources in <tt class="xref py py-mod docutils literal"><span class="pre">everest</span></tt> are
their advanced filtering, ordering and batching capabilities. Query strings
have to conform to a custom query language, the Collection Query Language
(CQL).</p>
<p>A CQL query consists of a filtering part, an ordering part, and a batching
part. All parts are optional; if they are omitted, the collection is returned
unfiltered using the default sort order and the default batch size defined
by the collection (if specified).</p>
<p>The filtering part of a CQL query (prefixed with the string <tt class="docutils literal"><span class="pre">q=</span></tt>) consists of
one or more criteria of the form</p>
<blockquote>
<div><tt class="docutils literal"><span class="pre">resource</span> <span class="pre">attribute</span> <span class="pre">name</span> <span class="pre">&quot;:&quot;</span> <span class="pre">operator</span> <span class="pre">&quot;:&quot;</span> <span class="pre">value</span></tt></div></blockquote>
<p>Example: <tt class="docutils literal"><span class="pre">last-name:equal-to:&quot;Doe&quot;</span></tt></p>
<p>It is possible to supply multiple criterion values in a comma separated
list, which will be interpreted as a Boolean &#8220;OR&#8221; operation on all given
values.</p>
<p>Supported types for a CQL criterion value are:</p>
<dl class="docutils">
<dt>String</dt>
<dd>Arbitrary string enclosed in double quotes.</dd>
<dt>Number</dt>
<dd>Integer or floating point, scientific notation allowed.</dd>
<dt>Boolean</dt>
<dd>Case insensitive string <strong>true</strong> or <strong>false</strong>.</dd>
<dt>Date/Time</dt>
<dd>ISO 8601 encoded string enclosed in double quotes.</dd>
<dt>Resource</dt>
<dd>URL referencing a resource.</dd>
</dl>
<p>The ordering part of a CQL query (prefixed with the string <tt class="docutils literal"><span class="pre">sort=</span></tt>)
consists of one or more order criteria of the form</p>
<blockquote>
<div><tt class="docutils literal"><span class="pre">resource</span> <span class="pre">attribute</span> <span class="pre">name</span> <span class="pre">&quot;:&quot;</span> <span class="pre">operator</span></tt></div></blockquote>
<p>where the operator is one of <tt class="docutils literal"><span class="pre">asc</span></tt> (ascending sort order) or <tt class="docutils literal"><span class="pre">desc</span></tt>
(descending sort order).</p>
<p>Example: <tt class="docutils literal"><span class="pre">last-name:asc</span></tt></p>
<p>In filtering and ordering query expressions, you can specify a dotted
identifier as the resource attribute name to query nested resources. Also,
multiple CQL filter and order criteria can be combined using the two logical
operators &#8220;<cite>AND</cite>&#8221; and &#8220;<cite>OR</cite>&#8221;. &#8220;<cite>AND</cite>&#8221; expressions have precedence over
&#8220;<cite>OR</cite>&#8221; expressions. The precedence rules can be overridden using open and
close parentheses (&#8220;<cite>(</cite>&#8221; and &#8220;<cite>)</cite>&#8221;). Using the tilde (&#8220;~&#8221;) character as a
shorthand for the &#8220;<cite>AND</cite>&#8221; operator is also supported; note, however, that you
can not combine a criteria expression that uses the tilde character with one
that uses the standard <cite>AND</cite> and <cite>OR</cite> operators.</p>
<p>The batching part of a CQL query can be used to specify a batch size (with
an expression of the form <tt class="docutils literal"><span class="pre">&quot;size&quot;</span> <span class="pre">&quot;=&quot;</span> <span class="pre">batch</span> <span class="pre">size</span></tt> where <tt class="docutils literal"><span class="pre">batch</span> <span class="pre">size</span></tt> is
an integer) and a batch number (with an expression of the form
<tt class="docutils literal"><span class="pre">&quot;offset&quot;</span> <span class="pre">&quot;=&quot;</span> <span class="pre">batch</span> <span class="pre">offset</span></tt> where <tt class="docutils literal"><span class="pre">batch</span> <span class="pre">offset</span></tt> is an integer).</p>
<p>The following table shows the available operators and data types in CQL:</p>
<table border="1" class="docutils">
<colgroup>
<col width="42%" />
<col width="12%" />
<col width="9%" />
<col width="10%" />
<col width="15%" />
<col width="12%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Operator</th>
<th class="head" colspan="5">Data Type</th>
</tr>
<tr class="row-even"><th class="head">Name</th>
<th class="head">String</th>
<th class="head">Number</th>
<th class="head">Boolean</th>
<th class="head">Date/Time</th>
<th class="head">Resource</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">starts-with</span></tt></td>
<td>x</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">not-starts-with</span></tt></td>
<td>x</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">ends-with</span></tt></td>
<td>x</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">not-ends-with</span></tt></td>
<td>x</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">contains</span></tt></td>
<td>x</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>x</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">not-contains</span></tt></td>
<td>x</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>x</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">contained</span></tt></td>
<td>x</td>
<td>x</td>
<td>x</td>
<td>x</td>
<td>x</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">not-contained</span></tt></td>
<td>x</td>
<td>x</td>
<td>x</td>
<td>x</td>
<td>x</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">equal-to</span></tt></td>
<td>x</td>
<td>x</td>
<td>x</td>
<td>x</td>
<td>x</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">not-equal-to</span></tt></td>
<td>x</td>
<td>x</td>
<td>x</td>
<td>x</td>
<td>x</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">less-than</span></tt></td>
<td>&nbsp;</td>
<td>x</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">less-than-or-equal-to</span></tt></td>
<td>&nbsp;</td>
<td>x</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">greater-than</span></tt></td>
<td>&nbsp;</td>
<td>x</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">greater-than-or-equal-to</span></tt></td>
<td>&nbsp;</td>
<td>x</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">in-range</span></tt></td>
<td>&nbsp;</td>
<td>x</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
</tbody>
</table>
<p>All attributes that are used to compose a query expression need to be mapped
column properties in the ORM. Aliases are supported, CompositeProperties are
not. All queried entities must have an &#8220;id&#8221; attribute.</p>
<p>It is by design that the power of CQL to express complex queries is far behind
that of SQL. CQL aims to provide a simple, uniform querying language for
all collection resources of an applciation regardless of the persistency
backend used.</p>
</div>
<div class="section" id="get-request-processing">
<h3>GET request processing<a class="headerlink" href="#get-request-processing" title="Permalink to this headline">¶</a></h3>
<p>A GET request to a collection resource with a query string such as</p>
<p><a class="reference external" href="http://localhost:6543/customers?q=first-name:startswith:&quot;J&quot;?order=last-name:asc?size=100">http://localhost:6543/customers?q=first-name:startswith:&#8221;J&#8221;?order=last-name:asc?size=100</a></p>
<p>is processed by <tt class="xref py py-mod docutils literal"><span class="pre">everest</span></tt> as follows:</p>
<blockquote>
<div><ol class="arabic simple">
<li>The context and its associated view are identified just as in any vanilla
<tt class="xref py py-mod docutils literal"><span class="pre">Pyramid</span></tt> application. In the example, this would be the <tt class="docutils literal"><span class="pre">customers</span></tt>
collection resource at the root of the object tree (the &#8220;root collection&#8221;)
and the <tt class="xref py py-class docutils literal"><span class="pre">everest.views.getcollection.GetCollectionView</span></tt>;</li>
<li>The view parses the query string submitted by the client (in the example,
the <tt class="docutils literal"><span class="pre">q=first-name:startswith:&quot;J&quot;</span></tt> part of the URL) into a resource
filter specification and applies it to the context collection resource.
This triggers a translation of the resource filter specification into
an entity filter specification which is then applied to the underlying
aggregate. This separation of resource and entity level attributes does
only make it possible to expose entity attributes under a different name
at the level of the resource, but also to expose attributes from nested
entities (using &#8220;dotted&#8221; identifiers);</li>
<li>The view processes the order string (<tt class="docutils literal"><span class="pre">order=last-name:asc</span></tt>) in the same
fashion as the query string;</li>
<li>The view parses the batch size string (<tt class="docutils literal"><span class="pre">size=100</span></tt>) and applies this
setting to the context collection resource;</li>
<li>The view iterates over the context collection resource and wraps the
filtered, ordered, and batched member resources into a new result
collection resource;</li>
<li>Using a representer, the view creates a string representation of the
appropriate content type (either requested by the client
or statically defined for the resource) from the result collection;</li>
<li>The view fills the response body with the representation, sets up the
response headers and returns the response for further processing through
the WSGI stack.</li>
</ol>
</div></blockquote>
</div>
</div>
<div class="section" id="customizing-representations">
<h2>2. Customizing representations<a class="headerlink" href="#customizing-representations" title="Permalink to this headline">¶</a></h2>
<p>The default behavior of the <tt class="xref py py-mod docutils literal"><span class="pre">everest</span></tt> representers is to</p>
<blockquote>
<div><ul class="simple">
<li>Represent all terminal attribute values as the value obtained by result of ;</li>
<li>Represent nested member resources as links (URLs); and</li>
<li>Ignore nested collection resources.</li>
</ul>
</div></blockquote>
<p>Nested collections are ignored by default because retrieving a collection can
be very expensive and even generating a URL for a collection typically requires
iterating over all its members.</p>
<p>To change these defaults for a given resource attribute, we set the appropriate
<tt class="docutils literal"><span class="pre">representer</span></tt>, <tt class="docutils literal"><span class="pre">attribute</span></tt> and <tt class="docutils literal"><span class="pre">option</span></tt> tags inside a <tt class="docutils literal"><span class="pre">resource</span></tt>
declaration. For example, to include the nested <tt class="docutils literal"><span class="pre">projects</span></tt> collection in
<tt class="docutils literal"><span class="pre">XML</span></tt> representations of <tt class="docutils literal"><span class="pre">customer</span></tt> members we would include the
following declaration in the <tt class="docutils literal"><span class="pre">ZCML</span></tt> configuration file:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;representer</span>
   <span class="na">kind=</span><span class="s">&quot;member&quot;</span>
   <span class="na">content_type=</span><span class="s">&quot;everest.mime.XmlMime&quot;</span>
<span class="nt">&gt;</span>
   <span class="nt">&lt;attribute</span> <span class="na">name=</span><span class="s">&quot;projects&quot;</span><span class="nt">&gt;</span>
       <span class="nt">&lt;option</span>
           <span class="na">name=</span><span class="s">&quot;ignore&quot;</span>
           <span class="na">value=</span><span class="s">&quot;false&quot;</span> <span class="nt">/&gt;</span>
       <span class="nt">&lt;option</span>
           <span class="na">name=</span><span class="s">&quot;write_as_link&quot;</span>
           <span class="na">value=</span><span class="s">&quot;false&quot;</span> <span class="nt">/&gt;</span>
   <span class="nt">&lt;/attribute&gt;</span>
<span class="nt">&lt;/representer&gt;</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">ignore</span></tt> option is a shorthand for setting both the <tt class="docutils literal"><span class="pre">ignore_on_read</span></tt>
and the <tt class="docutils literal"><span class="pre">ignore_on_write</span></tt> option which set the ignore behavior selectively
when a representation is parsed (<tt class="docutils literal"><span class="pre">ignore_on_read</span></tt>) or generated
(<tt class="docutils literal"><span class="pre">ignore_on_write</span></tt>). The <tt class="docutils literal"><span class="pre">write_as_link</span></tt> option ensures that the nested
resource is represented as a (URL) link rather than as an explicit
recursive representation of all its attributes.</p>
</div>
</div>


</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright Copyright (c) 2011-2013 F. Oliver Gathmann, Cenix BioScience, Dresden, Germany.<br/>
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.<br/>
    </p>
  </div>
</footer>
  </body>
</html>