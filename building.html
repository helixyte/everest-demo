
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Building everest applications &mdash; everest demo 0.1 documentation</title>
    
    <link rel="stylesheet" href="_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="everest demo 0.1 documentation" href="index.html" />
    <link rel="next" title="Using everest applications" href="using.html" />
    <link rel="prev" title="everest Tutorial" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="using.html" title="Using everest applications"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="everest Tutorial"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">everest demo 0.1 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="building-everest-applications">
<h1>Building <tt class="xref py py-mod docutils literal"><span class="pre">everest</span></tt> applications<a class="headerlink" href="#building-everest-applications" title="Permalink to this headline">¶</a></h1>
<p>In this section, you will find a step-by-step guide on how to build a RESTful
application with <tt class="xref py py-mod docutils literal"><span class="pre">everest</span></tt>.</p>
<div class="section" id="the-application">
<h2>1. The application<a class="headerlink" href="#the-application" title="Permalink to this headline">¶</a></h2>
<p>Suppose you want to write a program that helps a garden designer with composing
lists of beautiful perennials and shrubs that she intends to plant in her
customer&#8217;s gardens. Let&#8217;s call this fancy application &#8220;Plant Scribe&#8221;. In its
simplest possible form, this application will have to handle customers,
projects (per customer), sites (per project), and plant species (per site).</p>
</div>
<div class="section" id="designing-the-entity-model">
<h2>2. Designing the entity model<a class="headerlink" href="#designing-the-entity-model" title="Permalink to this headline">¶</a></h2>
<p><tt class="xref py py-mod docutils literal"><span class="pre">everest</span></tt> applications keep their value state in <a class="reference internal" href="glossary.html#term-entity"><em class="xref std std-term">entity</em></a> objects.</p>
<div class="sidebar">
<p class="first sidebar-title">Entities and Resources</p>
<p>The entity model implements the <a class="reference internal" href="glossary.html#term-domain-logic"><em class="xref std std-term">domain logic</em></a> of the application by
enforcing all value state constraints at all times.</p>
<p>Entities are manipulated through <a class="reference internal" href="glossary.html#term-resource"><em class="xref std std-term">resource</em></a> objects. A resource
object provides access either to a single entity object
(<a class="reference internal" href="glossary.html#term-member-resource"><em class="xref std std-term">member resource</em></a>) or to a collection of entities of the same kind
(<a class="reference internal" href="glossary.html#term-collection-resource"><em class="xref std std-term">collection resource</em></a>). Resources can call other resources to modify
other parts of the entity model, thus implementing the
<a class="reference internal" href="glossary.html#term-business-logic"><em class="xref std std-term">business logic</em></a> of the application.</p>
<p class="last">Each collection resource uses an <a class="reference internal" href="glossary.html#term-aggregate"><em class="xref std std-term">aggregate</em></a> to provide access to its
underlying entities. Aggregates support slicing, filtering, and ordering
operations.</p>
</div>
<p>The first step on our way to the Plant Scribe application is therefore to decide
which data we want to store in our entity model. We start with the customer:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">everest.entities.base</span> <span class="kn">import</span> <span class="n">Entity</span>
<span class="kn">from</span> <span class="nn">everest.entities.utils</span> <span class="kn">import</span> <span class="n">slug_from_string</span>

<span class="k">class</span> <span class="nc">Customer</span><span class="p">(</span><span class="n">Entity</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="n">Entity</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">first_name</span> <span class="o">=</span> <span class="n">first_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_name</span> <span class="o">=</span> <span class="n">last_name</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">slug</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">slug_from_string</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">-</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_name</span><span class="p">))</span>
</pre></div>
</td></tr></table></div>
<p>In our example, the <tt class="xref py py-class docutils literal"><span class="pre">Customer</span></tt> class inherits from the <tt class="xref py py-class docutils literal"><span class="pre">Entity</span></tt>
class provided by <tt class="xref py py-mod docutils literal"><span class="pre">everest</span></tt>. This is convenient, but not necessary; any
class can participate in the entity model as long as it implements the
<tt class="xref py py-class docutils literal"><span class="pre">everest.entities.interfaces.IEntity</span></tt> interface. Note, however, that
this interface requires the presence of a <tt class="docutils literal"><span class="pre">slug</span></tt> attribute, which in the case
of the customer entity is composed of the concatenation of the customer&#8217;s last
and first name.</p>
<div class="sidebar">
<p class="first sidebar-title">Slugs</p>
<p class="last">A <a class="reference internal" href="glossary.html#term-slug"><em class="xref std std-term">slug</em></a> is a character string that uniquely identifies an entity
within its aggregate. <tt class="xref py py-mod docutils literal"><span class="pre">everest</span></tt> uses the slug to generate an URL
for the member resource wrapping an entity, so, ideally, it should be a
short, mnemonic expression.</p>
</div>
<p>For each customer, we need to be able to handle an arbitrary number of projects:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">everest.entities.base</span> <span class="kn">import</span> <span class="n">Entity</span>
<span class="kn">from</span> <span class="nn">everest.entities.utils</span> <span class="kn">import</span> <span class="n">slug_from_string</span>

<span class="k">class</span> <span class="nc">Project</span><span class="p">(</span><span class="n">Entity</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">customer</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="n">Entity</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">customer</span> <span class="o">=</span> <span class="n">customer</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">slug</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">slug_from_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>Note that the <tt class="docutils literal"><span class="pre">name</span></tt> attribute, which serves as the project entity slug, does
not need to be unique among <em>all</em> projects, but just among all projects for a
given customer.</p>
<p>Another noteworthy observation is that although the project references the
customer, we do not (yet) have a way to access the projects associated with a
given customer as an attribute of its customer entity. Avoiding such circular
references allows us to keep our entity model simple, but we may be missing the
convenience they offer. We will return to this issue a little later.</p>
<p>Each project is referenced by one or more planting sites:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">everest.entities.base</span> <span class="kn">import</span> <span class="n">Entity</span>
<span class="kn">from</span> <span class="nn">everest.entities.utils</span> <span class="kn">import</span> <span class="n">slug_from_string</span>

<span class="k">class</span> <span class="nc">Site</span><span class="p">(</span><span class="n">Entity</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">project</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="n">Entity</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="n">project</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">slug</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">slug_from_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>The plant species to choose from for each site are modeled as follows:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">everest.entities.base</span> <span class="kn">import</span> <span class="n">Entity</span>
<span class="kn">from</span> <span class="nn">everest.entities.utils</span> <span class="kn">import</span> <span class="n">slug_from_string</span>

<span class="k">class</span> <span class="nc">Species</span><span class="p">(</span><span class="n">Entity</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">species_name</span><span class="p">,</span> <span class="n">genus_name</span><span class="p">,</span>
                 <span class="n">cultivar</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">author</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="n">Entity</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">species_name</span> <span class="o">=</span> <span class="n">species_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">genus_name</span> <span class="o">=</span> <span class="n">genus_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cultivar</span> <span class="o">=</span> <span class="n">cultivar</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">author</span> <span class="o">=</span> <span class="n">author</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">slug</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">slug_from_string</span><span class="p">(</span>
                    <span class="s">&quot;</span><span class="si">%s</span><span class="s">-</span><span class="si">%s</span><span class="s">-</span><span class="si">%s</span><span class="s">-</span><span class="si">%s</span><span class="s">&quot;</span>
                    <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">genus_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">species_name</span><span class="p">,</span>
                       <span class="s">&#39;&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cultivar</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">cultivar</span><span class="p">,</span>
                       <span class="s">&#39;&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">author</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">author</span><span class="p">))</span>
</pre></div>
</td></tr></table></div>
<p>Finally, the information about which plant species to use at which site and in
which quantity is modeled as an &#8220;incidence&#8221; entity:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">everest.entities.base</span> <span class="kn">import</span> <span class="n">Entity</span>

<span class="k">class</span> <span class="nc">Incidence</span><span class="p">(</span><span class="n">Entity</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">species</span><span class="p">,</span> <span class="n">site</span><span class="p">,</span> <span class="n">quantity</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="n">Entity</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">species</span> <span class="o">=</span> <span class="n">species</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">site</span> <span class="o">=</span> <span class="n">site</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">quantity</span> <span class="o">=</span> <span class="n">quantity</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">slug</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">None</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">species</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">slug</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="designing-and-building-the-resource-layer">
<h2>3. Designing and building the resource layer<a class="headerlink" href="#designing-and-building-the-resource-layer" title="Permalink to this headline">¶</a></h2>
<p>With the entity model in place, we can  now proceed to designing the resource
layer. The first step here is to define the marker interfaces that
<tt class="xref py py-mod docutils literal"><span class="pre">everest</span></tt> will use to access the various parts of the resource system.
This is very straightforward to do:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37</pre></div></td><td class="code"><div class="highlight"><pre><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This file is part of the everest project. </span>
<span class="sd">See LICENSE.txt for licensing, CONTRIBUTORS.txt for contributor information.</span>

<span class="sd">Created on Jan 9, 2012.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">zope.interface</span> <span class="kn">import</span> <span class="n">Interface</span> <span class="c"># pylint: disable=F0401</span>

<span class="n">__docformat__</span> <span class="o">=</span> <span class="s">&#39;reStructuredText en&#39;</span>
<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;ICustomer&#39;</span><span class="p">,</span>
           <span class="s">&#39;IIncidence&#39;</span><span class="p">,</span>
           <span class="s">&#39;IProject&#39;</span><span class="p">,</span>
           <span class="s">&#39;ISite&#39;</span><span class="p">,</span>
           <span class="s">&#39;ISpecies&#39;</span><span class="p">,</span>
           <span class="p">]</span>


<span class="c"># no __init__ pylint: disable=W0232</span>
<span class="k">class</span> <span class="nc">ICustomer</span><span class="p">(</span><span class="n">Interface</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">IProject</span><span class="p">(</span><span class="n">Interface</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">ISpecies</span><span class="p">(</span><span class="n">Interface</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">ISite</span><span class="p">(</span><span class="n">Interface</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">IIncidence</span><span class="p">(</span><span class="n">Interface</span><span class="p">):</span>
    <span class="k">pass</span>
<span class="c"># pylint: enable=W0232</span>
</pre></div>
</td></tr></table></div>
<p>Next, we move on to declaring the resource attributes using <tt class="xref py py-mod docutils literal"><span class="pre">everest</span></tt>&#8216;s
resource attribute descriptors. Each resource attribute descriptor maps a
single attribute from the resource&#8217;s entity and makes it available for access
from the outside.</p>
<div class="sidebar">
<p class="first sidebar-title">Resource Attribute Kinds</p>
<p class="last">There are three kinds of resource attributes in <tt class="xref py py-mod docutils literal"><span class="pre">everest</span></tt>: Terminal
attributes, member attributes, and collection attributes. A <em>terminal</em>
resource attribute references an object of an atomic type or some other type
that is not a resource itself. A <em>member</em> resource attribute references
another member resource and a <em>collection</em> resource attribute references
another collection resource. Resource attributes are declared using the
<tt class="xref py py-func docutils literal"><span class="pre">terminal_attribute()</span></tt>, <tt class="xref py py-func docutils literal"><span class="pre">member_attribute()</span></tt>, and
<tt class="xref py py-func docutils literal"><span class="pre">collection_attribute()</span></tt> descriptor generating functions from the
<tt class="xref py py-mod docutils literal"><span class="pre">resources.descriptors</span></tt> module.</p>
</div>
<p>In our example application, the resources mostly declare the public attributes
of the underlying entities as attributes:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">everest.resources.base</span> <span class="kn">import</span> <span class="n">Member</span>
<span class="kn">from</span> <span class="nn">everest.resources.descriptors</span> <span class="kn">import</span> <span class="n">collection_attribute</span>
<span class="kn">from</span> <span class="nn">everest.resources.descriptors</span> <span class="kn">import</span> <span class="n">terminal_attribute</span>
<span class="kn">from</span> <span class="nn">plantscribe.interfaces</span> <span class="kn">import</span> <span class="n">IProject</span>
<span class="kn">from</span> <span class="nn">everest.resources.descriptors</span> <span class="kn">import</span> <span class="n">attribute_alias</span>

<span class="k">class</span> <span class="nc">CustomerMember</span><span class="p">(</span><span class="n">Member</span><span class="p">):</span>
    <span class="n">relation</span> <span class="o">=</span> <span class="s">&#39;http://plantscribe.org/relations/customer&#39;</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">attribute_alias</span><span class="p">(</span><span class="s">&#39;last_name&#39;</span><span class="p">)</span>
    <span class="n">first_name</span> <span class="o">=</span> <span class="n">terminal_attribute</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="s">&#39;first_name&#39;</span><span class="p">)</span>
    <span class="n">last_name</span> <span class="o">=</span> <span class="n">terminal_attribute</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="s">&#39;last_name&#39;</span><span class="p">)</span>
    <span class="n">projects</span> <span class="o">=</span> <span class="n">collection_attribute</span><span class="p">(</span><span class="n">IProject</span><span class="p">,</span> <span class="n">backref</span><span class="o">=</span><span class="s">&#39;customer&#39;</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">everest.resources.base</span> <span class="kn">import</span> <span class="n">Member</span>
<span class="kn">from</span> <span class="nn">everest.resources.descriptors</span> <span class="kn">import</span> <span class="n">collection_attribute</span>
<span class="kn">from</span> <span class="nn">everest.resources.descriptors</span> <span class="kn">import</span> <span class="n">member_attribute</span>
<span class="kn">from</span> <span class="nn">everest.resources.descriptors</span> <span class="kn">import</span> <span class="n">terminal_attribute</span>
<span class="kn">from</span> <span class="nn">plantscribe.interfaces</span> <span class="kn">import</span> <span class="n">ICustomer</span>
<span class="kn">from</span> <span class="nn">plantscribe.interfaces</span> <span class="kn">import</span> <span class="n">ISite</span>
<span class="kn">from</span> <span class="nn">everest.resources.descriptors</span> <span class="kn">import</span> <span class="n">attribute_alias</span>

<span class="k">class</span> <span class="nc">ProjectMember</span><span class="p">(</span><span class="n">Member</span><span class="p">):</span>
    <span class="n">relation</span> <span class="o">=</span> <span class="s">&#39;http://plantscribe.org/relations/project&#39;</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">attribute_alias</span><span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">terminal_attribute</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">)</span>
    <span class="n">customer</span> <span class="o">=</span> <span class="n">member_attribute</span><span class="p">(</span><span class="n">ICustomer</span><span class="p">,</span> <span class="s">&#39;customer&#39;</span><span class="p">)</span>
    <span class="n">sites</span> <span class="o">=</span> <span class="n">collection_attribute</span><span class="p">(</span><span class="n">ISite</span><span class="p">,</span> <span class="n">backref</span><span class="o">=</span><span class="s">&#39;project&#39;</span><span class="p">,</span> <span class="n">is_nested</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">everest.resources.base</span> <span class="kn">import</span> <span class="n">Member</span>
<span class="kn">from</span> <span class="nn">everest.resources.descriptors</span> <span class="kn">import</span> <span class="n">collection_attribute</span>
<span class="kn">from</span> <span class="nn">everest.resources.descriptors</span> <span class="kn">import</span> <span class="n">member_attribute</span>
<span class="kn">from</span> <span class="nn">everest.resources.descriptors</span> <span class="kn">import</span> <span class="n">terminal_attribute</span>
<span class="kn">from</span> <span class="nn">plantscribe.interfaces</span> <span class="kn">import</span> <span class="n">IIncidence</span>
<span class="kn">from</span> <span class="nn">plantscribe.interfaces</span> <span class="kn">import</span> <span class="n">IProject</span>
<span class="kn">from</span> <span class="nn">everest.resources.descriptors</span> <span class="kn">import</span> <span class="n">attribute_alias</span>

<span class="k">class</span> <span class="nc">SiteMember</span><span class="p">(</span><span class="n">Member</span><span class="p">):</span>
    <span class="n">relation</span> <span class="o">=</span> <span class="s">&#39;http://plantscribe.org/relations/site&#39;</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">attribute_alias</span><span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">terminal_attribute</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">)</span>
    <span class="n">incidences</span> <span class="o">=</span> <span class="n">collection_attribute</span><span class="p">(</span><span class="n">IIncidence</span><span class="p">,</span> <span class="n">backref</span><span class="o">=</span><span class="s">&#39;site&#39;</span><span class="p">,</span>
                                      <span class="n">is_nested</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">project</span> <span class="o">=</span> <span class="n">member_attribute</span><span class="p">(</span><span class="n">IProject</span><span class="p">,</span> <span class="s">&#39;project&#39;</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">everest.resources.base</span> <span class="kn">import</span> <span class="n">Member</span>
<span class="kn">from</span> <span class="nn">everest.resources.descriptors</span> <span class="kn">import</span> <span class="n">terminal_attribute</span>
<span class="kn">from</span> <span class="nn">everest.resources.descriptors</span> <span class="kn">import</span> <span class="n">attribute_alias</span>

<span class="k">class</span> <span class="nc">SpeciesMember</span><span class="p">(</span><span class="n">Member</span><span class="p">):</span>
    <span class="n">relation</span> <span class="o">=</span> <span class="s">&#39;http://plantscribe.org/relations/species&#39;</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">attribute_alias</span><span class="p">(</span><span class="s">&#39;species_name&#39;</span><span class="p">)</span>
    <span class="n">species_name</span> <span class="o">=</span> <span class="n">terminal_attribute</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="s">&#39;species_name&#39;</span><span class="p">)</span>
    <span class="n">genus_name</span> <span class="o">=</span> <span class="n">terminal_attribute</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="s">&#39;genus_name&#39;</span><span class="p">)</span>
    <span class="n">cultivar</span> <span class="o">=</span> <span class="n">terminal_attribute</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="s">&#39;cultivar&#39;</span><span class="p">)</span>
    <span class="n">author</span> <span class="o">=</span> <span class="n">terminal_attribute</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="s">&#39;author&#39;</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">everest.resources.base</span> <span class="kn">import</span> <span class="n">Member</span>
<span class="kn">from</span> <span class="nn">everest.resources.descriptors</span> <span class="kn">import</span> <span class="n">member_attribute</span>
<span class="kn">from</span> <span class="nn">everest.resources.descriptors</span> <span class="kn">import</span> <span class="n">terminal_attribute</span>
<span class="kn">from</span> <span class="nn">plantscribe.interfaces</span> <span class="kn">import</span> <span class="n">ISite</span>
<span class="kn">from</span> <span class="nn">plantscribe.interfaces</span> <span class="kn">import</span> <span class="n">ISpecies</span>

<span class="k">class</span> <span class="nc">IncidenceMember</span><span class="p">(</span><span class="n">Member</span><span class="p">):</span>
    <span class="n">relation</span> <span class="o">=</span> <span class="s">&#39;http://plantscribe.org/relations/incidence&#39;</span>
    <span class="n">species</span> <span class="o">=</span> <span class="n">member_attribute</span><span class="p">(</span><span class="n">ISpecies</span><span class="p">,</span> <span class="s">&#39;species&#39;</span><span class="p">)</span>
    <span class="n">site</span> <span class="o">=</span> <span class="n">member_attribute</span><span class="p">(</span><span class="n">ISite</span><span class="p">,</span> <span class="s">&#39;site&#39;</span><span class="p">)</span>
    <span class="n">quantity</span> <span class="o">=</span> <span class="n">terminal_attribute</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="s">&#39;quantity&#39;</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>In the simple case where the resource attribute descriptor declares a public
attribute of the underlying entity, it expects a type or an interface of the
target object and the name of the corresponding entity attribute as arguments.</p>
<p>For <tt class="xref py py-func docutils literal"><span class="pre">member_attribute()</span></tt> and <tt class="xref py py-func docutils literal"><span class="pre">collection_attribute()</span></tt> descriptors there
is also an optional argument <tt class="docutils literal"><span class="pre">is_nested</span></tt> which determines if the URL for the
target resource is going to be formed relative to the root (i.e., as an
absolute path) or relative to the parent resource declaring the attribute.</p>
<div class="sidebar">
<p class="first sidebar-title">URL resolution</p>
<p class="last"><tt class="xref py py-mod docutils literal"><span class="pre">everest</span></tt> favors and facilitates object traversal for URL resolution.
In particular, all resource attributes that target a member or collection
resource can be used directly for URL traversal unless they are specifically
set as non-nested resource in the corresponding resource attribute
declaration.</p>
</div>
<p>We also have the possibility to declare resource attributes that do not
reference the target resource directly through an entity attribute, but
indirectly through a &#8220;backreferencing&#8221; attribute. In the example code, this is
demonstrated in the <tt class="docutils literal"><span class="pre">projects</span></tt> attribute of the <tt class="xref py py-class docutils literal"><span class="pre">CustomerMember</span></tt>
resource which allows us to access a customer&#8217;s projects at the resource level
even though the underlying entity does not reference its projects directly.</p>
</div>
<div class="section" id="configuring-the-application">
<h2>4. Configuring the application<a class="headerlink" href="#configuring-the-application" title="Permalink to this headline">¶</a></h2>
<p>With the resource layer in place, we can now move on to configuring our
application. <tt class="xref py py-mod docutils literal"><span class="pre">everest</span></tt> applications are based on the <tt class="xref py py-mod docutils literal"><span class="pre">pyramid</span></tt>
framework and everything you learned about configuring <tt class="xref py py-mod docutils literal"><span class="pre">pyramid</span></tt>
applications can be applied here. Rather than duplicating the excellent
documentation available on the Pyramid web site, we will focus on a minimal
example on how to configure the extra resource functionality that
<tt class="xref py py-mod docutils literal"><span class="pre">everest</span></tt> supplies.</p>
<p>The minimal <tt class="docutils literal"><span class="pre">.ini</span></tt> file for the <tt class="docutils literal"><span class="pre">plantscribe</span></tt> application is quite simple:</p>
<div class="highlight-python"><pre>[DEFAULT]

[app:main]
db_string = sqlite://
paste.app_factory = plantscribe.run:app_factory

#folder for static content (e.g. your everest-flex app):
public_dir = %(here)s/public

[server:main]
use = egg:Paste#http
host = 0.0.0.0
port = 6543

# Logging configuration
[loggers]
keys = root, plantscribe, sqlalchemy

[handlers]
keys = console

[formatters]
keys = generic

[logger_root]
level = DEBUG
handlers = console

[logger_plantscribe]
level = DEBUG
handlers = console
qualname = plantscribe.*

[logger_sqlalchemy]
level = INFO
handlers = console
qualname = sqlalchemy.engine
propagate = 0
# "level = INFO" logs SQL queries.
# "level = DEBUG" logs SQL queries and results.
# "level = WARN" logs neither.  (Recommended for production systems.)

[handler_console]
class = StreamHandler
args = (sys.stderr,)
level = NOTSET
formatter = generic

[formatter_generic]
format = %(asctime)s,%(msecs)03d %(levelname)-5.5s [%(name)s] %(message)s
datefmt = %H:%M:%S
</pre>
</div>
<p>The only purpose of the <tt class="docutils literal"><span class="pre">.ini</span></tt> file is to specify a <tt class="docutils literal"><span class="pre">Paster</span></tt> application
factory which is responsible for creating and setting up the application
registry and for instantiating a WSGI application.</p>
<p>The <tt class="docutils literal"><span class="pre">.zcml</span></tt> configuration file - which is loaded through the application
factory - is more interesting:</p>
<div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93</pre></div></td><td class="code"><div class="highlight"><pre><span class="nt">&lt;configure</span> <span class="na">xmlns=</span><span class="s">&quot;http://pylonshq.com/pyramid&quot;</span><span class="nt">&gt;</span>

    <span class="c">&lt;!-- Include special directives. --&gt;</span>

    <span class="nt">&lt;include</span> <span class="na">package=</span><span class="s">&quot;everest.includes&quot;</span> <span class="nt">/&gt;</span>

    <span class="c">&lt;!-- Repositories. --&gt;</span>

    <span class="nt">&lt;filesystem_repository</span>
        <span class="na">directory=</span><span class="s">&quot;tests/data&quot;</span>
        <span class="na">content_type=</span><span class="s">&quot;everest.mime.CsvMime&quot;</span>
        <span class="na">make_default=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>

    <span class="c">&lt;!-- Use this to try out the SQL alchemy backend (you will need to</span>
<span class="c">         comment out the filesystem_repository directive above)</span>
<span class="c">    &lt;orm_repository metadata_factory=&#39;plantscribe.orm.create_metadata&#39;</span>
<span class="c">        make_default=&quot;true&quot; /&gt;</span>
<span class="c">        --&gt;</span>

    <span class="c">&lt;!-- Representers. --&gt;</span>

    <span class="nt">&lt;representer</span> <span class="na">content_type=</span><span class="s">&quot;everest.mime.XmlMime&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;option</span>
            <span class="na">name=</span><span class="s">&quot;xml_schema&quot;</span>
            <span class="na">value=</span><span class="s">&quot;plantscribe:resources/Plantscribe.xsd&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;option</span>
            <span class="na">name=</span><span class="s">&quot;xml_ns&quot;</span>
            <span class="na">value=</span><span class="s">&quot;http://schemata.everest.org/plantscribe&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;option</span>
            <span class="na">name=</span><span class="s">&quot;xml_prefix&quot;</span>
            <span class="na">value=</span><span class="s">&quot;ps&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/representer&gt;</span>

    <span class="c">&lt;!-- Resource declarations. --&gt;</span>

    <span class="nt">&lt;include</span> <span class="na">file=</span><span class="s">&quot;resources.zcml&quot;</span> <span class="nt">/&gt;</span>

    <span class="c">&lt;!-- Views. --&gt;</span>

    <span class="nt">&lt;collection_view</span>
        <span class="na">for=</span><span class="s">&quot;plantscribe.interfaces.ICustomer</span>
<span class="s">             plantscribe.interfaces.IProject</span>
<span class="s">             plantscribe.interfaces.ISpecies</span>
<span class="s">            &quot;</span>
        <span class="na">view=</span><span class="s">&quot;everest.views.getcollection.GetCollectionView&quot;</span>
        <span class="na">renderer=</span><span class="s">&quot;atom&quot;</span>
        <span class="na">request_method=</span><span class="s">&quot;GET&quot;</span> <span class="nt">/&gt;</span>

    <span class="nt">&lt;collection_view</span>
        <span class="na">for=</span><span class="s">&quot;plantscribe.interfaces.ICustomer</span>
<span class="s">             plantscribe.interfaces.IProject</span>
<span class="s">             plantscribe.interfaces.ISpecies</span>
<span class="s">            &quot;</span>
        <span class="na">view=</span><span class="s">&quot;everest.views.postcollection.PostCollectionView&quot;</span>
        <span class="na">renderer=</span><span class="s">&quot;atom&quot;</span>
        <span class="na">request_method=</span><span class="s">&quot;POST&quot;</span>
        <span class="na">permission=</span><span class="s">&quot;create&quot;</span> <span class="nt">/&gt;</span>


    <span class="nt">&lt;member_view</span>
        <span class="na">for=</span><span class="s">&quot;plantscribe.interfaces.ISite</span>
<span class="s">             plantscribe.interfaces.ICustomer</span>
<span class="s">             plantscribe.interfaces.IProject</span>
<span class="s">             plantscribe.interfaces.ISpecies</span>
<span class="s">             &quot;</span>
        <span class="na">view=</span><span class="s">&quot;everest.views.getmember.GetMemberView&quot;</span>
        <span class="na">renderer=</span><span class="s">&quot;atom&quot;</span>
        <span class="na">request_method=</span><span class="s">&quot;GET&quot;</span> <span class="nt">/&gt;</span>

    <span class="nt">&lt;collection_view</span>
        <span class="na">for=</span><span class="s">&quot;plantscribe.interfaces.ICustomer</span>
<span class="s">             plantscribe.interfaces.IProject</span>
<span class="s">             plantscribe.interfaces.ISpecies</span>
<span class="s">            &quot;</span>
        <span class="na">name=</span><span class="s">&quot;csv&quot;</span>
        <span class="na">accept=</span><span class="s">&quot;application/csv&quot;</span>
        <span class="na">view=</span><span class="s">&quot;everest.views.getcollection.GetCollectionView&quot;</span>
        <span class="na">renderer=</span><span class="s">&quot;csv&quot;</span>
        <span class="na">request_method=</span><span class="s">&quot;GET&quot;</span> <span class="nt">/&gt;</span>

    <span class="c">&lt;!-- public folder for static content --&gt;</span>
    <span class="nt">&lt;view</span>
        <span class="na">context=</span><span class="s">&quot;everest.resources.interfaces.IService&quot;</span>
        <span class="na">view=</span><span class="s">&quot;everest.views.static.public_view&quot;</span>
        <span class="na">name=</span><span class="s">&quot;public&quot;</span>
        <span class="na">request_method=</span><span class="s">&quot;GET&quot;</span> <span class="nt">/&gt;</span>

    <span class="c">&lt;!-- this gives a static reference to the resources directory to be able</span>
<span class="c">         to load the xsd file from the outside world --&gt;</span>
    <span class="nt">&lt;static</span>
        <span class="na">name=</span><span class="s">&quot;Resource.xsd&quot;</span>
        <span class="na">path=</span><span class="s">&quot;everest:representers/Resource.xsd&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/configure&gt;</span>
</pre></div>
</td></tr></table></div>
<p>Note the <tt class="docutils literal"><span class="pre">include</span></tt> directive at the top of the file; this not only pulls in
the <tt class="xref py py-mod docutils literal"><span class="pre">everest</span></tt>-specific ZCML directives, but also the Pyramid directives as
well.</p>
<p>The <tt class="docutils literal"><span class="pre">filesystem_repository</span></tt> declaration sets up a default resource repository
backed by the file system in the <cite>tests/data</cite> folder as specified by the
<cite>directory</cite> option. We will return to the topic of setting up and configuring
resource repositories later.</p>
<p>The most important of the <tt class="xref py py-mod docutils literal"><span class="pre">everest</span></tt>-specific declarations are made using
the <tt class="docutils literal"><span class="pre">resource</span></tt> directive. In the example application, the resources are
declared in a separate <tt class="docutils literal"><span class="pre">zcml</span></tt> file (only the declarations for the
<tt class="docutils literal"><span class="pre">ICustomer</span></tt> resource shown for brevity):</p>
<div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47</pre></div></td><td class="code"><div class="highlight"><pre><span class="nt">&lt;configure</span> <span class="na">xmlns=</span><span class="s">&quot;http://pylonshq.com/pyramid&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;resource</span>
        <span class="na">interface=</span><span class="s">&#39;plantscribe.interfaces.ICustomer&#39;</span>
        <span class="na">member=</span><span class="s">&quot;plantscribe.resources.customer.CustomerMember&quot;</span>
        <span class="na">collection_root_name=</span><span class="s">&quot;customers&quot;</span>
        <span class="na">entity=</span><span class="s">&quot;plantscribe.entities.customer.Customer&quot;</span>
    <span class="nt">&gt;</span>
        <span class="nt">&lt;representer</span>
            <span class="na">kind=</span><span class="s">&quot;member&quot;</span>
            <span class="na">content_type=</span><span class="s">&quot;everest.mime.XmlMime&quot;</span>
        <span class="nt">&gt;</span>
            <span class="nt">&lt;option</span>
                <span class="na">name=</span><span class="s">&quot;xml_tag&quot;</span>
                <span class="na">value=</span><span class="s">&quot;customer&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;attribute</span> <span class="na">name=</span><span class="s">&quot;projects&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;option</span>
                    <span class="na">name=</span><span class="s">&quot;ignore&quot;</span>
                    <span class="na">value=</span><span class="s">&quot;false&quot;</span>
                    <span class="na">type=</span><span class="s">&quot;zope.configuration.fields.Bool&quot;</span> <span class="nt">/&gt;</span>
                <span class="nt">&lt;option</span>
                    <span class="na">name=</span><span class="s">&quot;write_as_link&quot;</span>
                    <span class="na">value=</span><span class="s">&quot;false&quot;</span>
                    <span class="na">type=</span><span class="s">&quot;zope.configuration.fields.Bool&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;/attribute&gt;</span>
            <span class="nt">&lt;attribute</span> <span class="na">name=</span><span class="s">&quot;projects.sites&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;option</span>
                    <span class="na">name=</span><span class="s">&quot;ignore&quot;</span>
                    <span class="na">value=</span><span class="s">&quot;false&quot;</span>
                    <span class="na">type=</span><span class="s">&quot;zope.configuration.fields.Bool&quot;</span> <span class="nt">/&gt;</span>
                <span class="nt">&lt;option</span>
                    <span class="na">name=</span><span class="s">&quot;write_as_link&quot;</span>
                    <span class="na">value=</span><span class="s">&quot;false&quot;</span>
                    <span class="na">type=</span><span class="s">&quot;zope.configuration.fields.Bool&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;/attribute&gt;</span>
        <span class="nt">&lt;/representer&gt;</span>
        <span class="nt">&lt;representer</span>
            <span class="na">kind=</span><span class="s">&quot;collection&quot;</span>
            <span class="na">content_type=</span><span class="s">&quot;everest.mime.XmlMime&quot;</span>
        <span class="nt">&gt;</span>
            <span class="nt">&lt;option</span>
                <span class="na">name=</span><span class="s">&quot;xml_tag&quot;</span>
                <span class="na">value=</span><span class="s">&quot;customers&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/representer&gt;</span>
    <span class="nt">&lt;/resource&gt;</span>

<span class="nt">&lt;/configure&gt;</span>
</pre></div>
</td></tr></table></div>
<div class="sidebar">
<p class="first sidebar-title">The resource subsystem</p>
<p>This graphics shows the relationship of the four main components of the
resource subsystem for a hypothetical resource <tt class="docutils literal"><span class="pre">Foo</span></tt>. At the center is
the marker interface <tt class="docutils literal"><span class="pre">IFoo</span></tt> with which all other components can be
retrieved (and configured) at runtime.</p>
<p class="last"><img alt="resource_classes" src="_images/resource_classes.png" /></p>
</div>
<p>Each <tt class="docutils literal"><span class="pre">resource</span></tt> directive sets up the various components of the
resource subsystem, using our marker interfaces as the glue. At the minimum,
you need to specify</p>
<ul class="simple">
<li>A marker interface for your resource;</li>
<li>An entity class for the resource;</li>
<li>A member class class for the resource; and</li>
<li>A name for the root collection.</li>
</ul>
<p>The aggregate and collection objects needed by the resource subsystem
are created automatically; you may, however, supply a custom collection class
that inherits from <tt class="xref py py-class docutils literal"><span class="pre">everest.resources.base.Collection</span></tt>. If you do not
plan on exposing the collection for this resource to the outside, you can set
the <tt class="docutils literal"><span class="pre">expose</span></tt> flag to <tt class="docutils literal"><span class="pre">false</span></tt>, in which case you do not need to provide a
root collection name. Non-exposed resources will still be available as a root
collection internally, but access through the service as well as the generation
of absolute URLs for them will not work.</p>
<p>Each <tt class="docutils literal"><span class="pre">resource</span></tt> directive may then contain one or several <tt class="docutils literal"><span class="pre">representer</span></tt>
directives to specify how this resource should be converted to a representation
and vice versa. You always need to specify the <tt class="docutils literal"><span class="pre">content_type</span></tt> a representer
directive configures; in addition, you may specify the resource <tt class="docutils literal"><span class="pre">kind</span></tt> to
configure as either &#8220;<tt class="docutils literal"><span class="pre">member</span></tt>&#8221; or &#8220;<tt class="docutils literal"><span class="pre">collection</span></tt>&#8221;. Then, the representer
configuration can be specified using one or several <tt class="docutils literal"><span class="pre">option</span></tt> tags which
have a <tt class="docutils literal"><span class="pre">name</span></tt>, a <tt class="docutils literal"><span class="pre">value</span></tt> and an optional <tt class="docutils literal"><span class="pre">type</span></tt> attribute. In addition,
the representation of individual resource attributes can be fine-tuned using
<tt class="docutils literal"><span class="pre">attribute</span></tt> tags. We will explain this feature in more detail later.</p>
</div>
<div class="section" id="running-the-application">
<h2>5. Running the application<a class="headerlink" href="#running-the-application" title="Permalink to this headline">¶</a></h2>
<p>To see our little application in action, we can use the <tt class="docutils literal"><span class="pre">pshell</span></tt> interactive
shell that comes with <tt class="docutils literal"><span class="pre">Pyramid</span></tt>. First, install the <tt class="docutils literal"><span class="pre">plantscribe</span></tt> demo
application by issuing</p>
<div class="highlight-text"><div class="highlight"><pre>$ pip install -e .
</pre></div>
</div>
<p>inside a the root folder of a clone of the <tt class="docutils literal"><span class="pre">everest-demo</span></tt> project on github
(<cite>https://github.com/cenix/everest-demo.git</cite>). This
presumes you have followed the instructions of installing <tt class="xref py py-mod docutils literal"><span class="pre">everest</span></tt> and
use a <tt class="docutils literal"><span class="pre">virtualenv</span></tt> with the <tt class="docutils literal"><span class="pre">pip</span></tt> installer (cf. xxx).</p>
<p>Now, still from the same directory, you start the <tt class="docutils literal"><span class="pre">Pyramid</span></tt> <tt class="docutils literal"><span class="pre">pshell</span></tt> like
this:</p>
<div class="highlight-text"><div class="highlight"><pre>$ pshell plantscribe.ini
Python 2.7.2 (v2.7.2:8527427914a2, Jun 11 2011, 15:22:34)
[GCC 4.2.1 (Apple Inc. build 5666) (dot 3)] on darwin
Type &quot;help&quot; for more information.

Environment:
  app          The WSGI application.
  registry     Active Pyramid registry.
  request      Active request object.
  root         Root of the default resource tree.
  root_factory Default root factory used to create `root`.

&gt;&gt;&gt;
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">root</span></tt> object that is available in the <tt class="docutils literal"><span class="pre">pshell</span></tt> environment is the
service object that provides access to all public root collections by name:</p>
<div class="highlight-text"><div class="highlight"><pre>&gt;&gt;&gt; c = root[&#39;customers&#39;]
&gt;&gt;&gt; c
&lt;CustomerMemberCollection name:customers parent:Service(started)&gt;
</pre></div>
</div>
<p>We can now start adding members to the collection and retrieve them back from
the collection:</p>
<div class="highlight-text"><div class="highlight"><pre>&gt;&gt;&gt; from plantscribe.entities.customer import Customer
&gt;&gt;&gt; ent = Customer(&#39;Peter&#39;, &#39;Fox&#39;)
&gt;&gt;&gt; m = c.create_member(ent)
&gt;&gt;&gt; m.__name__
&#39;fox-peter&#39;
&gt;&gt;&gt; c.get(&#39;fox-peter&#39;).__name__
&#39;fox-peter&#39;
</pre></div>
</div>
</div>
<div class="section" id="adding-persistency">
<h2>6. Adding persistency<a class="headerlink" href="#adding-persistency" title="Permalink to this headline">¶</a></h2>
<p>With the application running, we now turn our attention to persistency.
<tt class="xref py py-mod docutils literal"><span class="pre">everest</span></tt> uses a <a class="reference internal" href="glossary.html#term-repository"><em class="xref std std-term">repository</em></a> to load and save resources from and to
a storage backend.</p>
<p>By default, <tt class="xref py py-mod docutils literal"><span class="pre">everest</span></tt> does use a memory-based repository to store
resources, which of course implies that there . The following ZCML declaration
defines a filesystem-based repository as the default for our
application:</p>
<div class="highlight-text"><div class="highlight"><pre>&lt;filesystem_repository
   directory=&quot;data&quot;
   content_type=&quot;everest.mime.CsvMime&quot;
   make_default=&quot;true&quot; /&gt;
</pre></div>
</div>
<p>This tells <tt class="xref py py-mod docutils literal"><span class="pre">everest</span></tt> to use the <tt class="docutils literal"><span class="pre">data</span></tt> directory (relative to the
<tt class="docutils literal"><span class="pre">plantscribe</span></tt> package) to persist representations of the root collections of
all resources as <tt class="docutils literal"><span class="pre">.csv</span></tt> (Comma Separated Value) files. When the application
is initialized, the root collections are loaded from these representation files
and during each <tt class="docutils literal"><span class="pre">commit</span></tt> operation at the end of a transaction, all modified
root collections are written back to their corresponding representation files.</p>
<p>The filesystem-based repository does not perform well with complex or high
volume data structures or in cases where several processes need to access the
same persistency backend. In these situations, we need to switch to a an
ORM-based repository. <tt class="xref py py-mod docutils literal"><span class="pre">everest</span></tt> uses <a class="reference external" href="http://sqlalchemy.org">SQLAlchemy</a>
as ORM. What follows is a highly simplified account of what is needed to</p>
<blockquote>
<div>instruct <tt class="docutils literal"><span class="pre">SQLAlchemy</span></tt> to persist the entities of an <tt class="xref py py-mod docutils literal"><span class="pre">everest</span></tt></div></blockquote>
<p>application; for an explanation of the terms and concepts used in this section,
please refer to the excellent documentation on the <tt class="docutils literal"><span class="pre">SQLAlchemy</span></tt> web site.</p>
<p>In a first step, we need to initialize the ORM. The following ZCML declaration
makes the ORM the default resource repository:</p>
<div class="highlight-text"><div class="highlight"><pre>&lt;orm_repository
    metadata_factory=&quot;everest.tests.testapp_db.db.create_metadata&quot;
    make_default=&quot;true&quot;/&gt;
</pre></div>
</div>
<p>The metadata factory setting references a callable that takes an <tt class="docutils literal"><span class="pre">SQLAlchemy</span></tt>
engine as a parameter and returns a fully initialized metadata instance. For
our simple application, this function looks like this:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115</pre></div></td><td class="code"><div class="highlight"><pre><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This file is part of the everest project. </span>
<span class="sd">See LICENSE.txt for licensing, CONTRIBUTORS.txt for contributor information.</span>

<span class="sd">Created on Mar 27, 2012.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">everest.orm</span> <span class="kn">import</span> <span class="n">as_slug_expression</span>
<span class="kn">from</span> <span class="nn">everest.orm</span> <span class="kn">import</span> <span class="n">mapper</span>
<span class="kn">from</span> <span class="nn">plantscribe.entities.customer</span> <span class="kn">import</span> <span class="n">Customer</span>
<span class="kn">from</span> <span class="nn">plantscribe.entities.incidence</span> <span class="kn">import</span> <span class="n">Incidence</span>
<span class="kn">from</span> <span class="nn">plantscribe.entities.project</span> <span class="kn">import</span> <span class="n">Project</span>
<span class="kn">from</span> <span class="nn">plantscribe.entities.site</span> <span class="kn">import</span> <span class="n">Site</span>
<span class="kn">from</span> <span class="nn">plantscribe.entities.species</span> <span class="kn">import</span> <span class="n">Species</span>
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">Column</span>
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">Float</span>
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">ForeignKey</span>
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">Integer</span>
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">MetaData</span>
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">String</span>
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">Table</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">relationship</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.sql</span> <span class="kn">import</span> <span class="n">literal</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.sql</span> <span class="kn">import</span> <span class="n">select</span>

<span class="n">__docformat__</span> <span class="o">=</span> <span class="s">&#39;reStructuredText en&#39;</span>
<span class="n">__all__</span> <span class="o">=</span> <span class="p">[]</span>


<span class="k">def</span> <span class="nf">customer_slug</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">as_slug_expression</span><span class="p">(</span><span class="n">cls</span><span class="o">.</span><span class="n">last_name</span> <span class="o">+</span> <span class="n">literal</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">cls</span><span class="o">.</span><span class="n">first_name</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">project_slug</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">as_slug_expression</span><span class="p">(</span><span class="n">cls</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">species_slug</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">as_slug_expression</span><span class="p">(</span><span class="n">cls</span><span class="o">.</span><span class="n">genus_name</span> <span class="o">+</span> <span class="n">literal</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">)</span> <span class="o">+</span>
                              <span class="n">cls</span><span class="o">.</span><span class="n">species_name</span> <span class="o">+</span> <span class="n">literal</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">)</span> <span class="o">+</span>
                              <span class="n">cls</span><span class="o">.</span><span class="n">cultivar</span> <span class="o">+</span> <span class="n">literal</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">)</span> <span class="o">+</span>
                              <span class="n">cls</span><span class="o">.</span><span class="n">author</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">site_slug</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">as_slug_expression</span><span class="p">(</span><span class="n">cls</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">incidence_slug</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
    <span class="k">return</span> \
        <span class="n">select</span><span class="p">([</span><span class="n">Species</span><span class="o">.</span><span class="n">slug</span><span class="p">])</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">cls</span><span class="o">.</span><span class="n">species_id</span> <span class="o">==</span> <span class="n">Species</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">as_scalar</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">create_metadata</span><span class="p">(</span><span class="n">engine</span><span class="p">):</span>
    <span class="c"># Create metadata.</span>
    <span class="n">metadata</span> <span class="o">=</span> <span class="n">MetaData</span><span class="p">()</span>
    <span class="c"># Define a database schema..</span>
    <span class="n">customer_tbl</span> <span class="o">=</span> \
        <span class="n">Table</span><span class="p">(</span><span class="s">&#39;customer&#39;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span>
              <span class="n">Column</span><span class="p">(</span><span class="s">&#39;customer_id&#39;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
              <span class="n">Column</span><span class="p">(</span><span class="s">&#39;first_name&#39;</span><span class="p">,</span> <span class="n">String</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">),</span>
              <span class="n">Column</span><span class="p">(</span><span class="s">&#39;last_name&#39;</span><span class="p">,</span> <span class="n">String</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">),</span>
              <span class="p">)</span>
    <span class="n">project_tbl</span> <span class="o">=</span> \
        <span class="n">Table</span><span class="p">(</span><span class="s">&#39;project&#39;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span>
              <span class="n">Column</span><span class="p">(</span><span class="s">&#39;project_id&#39;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
              <span class="n">Column</span><span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="n">String</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">),</span>
              <span class="n">Column</span><span class="p">(</span><span class="s">&#39;customer_id&#39;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span>
                     <span class="n">ForeignKey</span><span class="p">(</span><span class="n">customer_tbl</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">customer_id</span><span class="p">),</span>
                     <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">),</span>
              <span class="p">)</span>
    <span class="n">site_tbl</span> <span class="o">=</span> \
        <span class="n">Table</span><span class="p">(</span><span class="s">&#39;site&#39;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span>
              <span class="n">Column</span><span class="p">(</span><span class="s">&#39;site_id&#39;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
              <span class="n">Column</span><span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="n">String</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">),</span>
              <span class="n">Column</span><span class="p">(</span><span class="s">&#39;project_id&#39;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span>
                     <span class="n">ForeignKey</span><span class="p">(</span><span class="n">project_tbl</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">project_id</span><span class="p">),</span>
                     <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">),</span>
              <span class="p">)</span>
    <span class="n">species_tbl</span> <span class="o">=</span> \
        <span class="n">Table</span><span class="p">(</span><span class="s">&#39;species&#39;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span>
              <span class="n">Column</span><span class="p">(</span><span class="s">&#39;species_id&#39;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
              <span class="n">Column</span><span class="p">(</span><span class="s">&#39;species_name&#39;</span><span class="p">,</span> <span class="n">String</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">),</span>
              <span class="n">Column</span><span class="p">(</span><span class="s">&#39;genus_name&#39;</span><span class="p">,</span> <span class="n">String</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">),</span>
              <span class="n">Column</span><span class="p">(</span><span class="s">&#39;cultivar&#39;</span><span class="p">,</span> <span class="n">String</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">),</span>
              <span class="n">Column</span><span class="p">(</span><span class="s">&#39;author&#39;</span><span class="p">,</span> <span class="n">String</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">),</span>
              <span class="p">)</span>
    <span class="n">incidence_tbl</span> <span class="o">=</span> \
        <span class="n">Table</span><span class="p">(</span><span class="s">&#39;incidence&#39;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span>
              <span class="n">Column</span><span class="p">(</span><span class="s">&#39;site_id&#39;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span>
                     <span class="n">ForeignKey</span><span class="p">(</span><span class="n">site_tbl</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">site_id</span><span class="p">),</span>
                     <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">),</span>
              <span class="n">Column</span><span class="p">(</span><span class="s">&#39;species_id&#39;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span>
                     <span class="n">ForeignKey</span><span class="p">(</span><span class="n">species_tbl</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">species_id</span><span class="p">),</span>
                     <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">),</span>
              <span class="n">Column</span><span class="p">(</span><span class="s">&#39;quantity&#39;</span><span class="p">,</span> <span class="n">Float</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">),</span>
              <span class="p">)</span>
    <span class="c"># Map tables to entity classes.</span>
    <span class="n">mapper</span><span class="p">(</span><span class="n">Customer</span><span class="p">,</span> <span class="n">customer_tbl</span><span class="p">,</span>
           <span class="n">id_attribute</span><span class="o">=</span><span class="s">&#39;customer_id&#39;</span><span class="p">,</span> <span class="n">slug_expression</span><span class="o">=</span><span class="n">customer_slug</span><span class="p">)</span>
    <span class="n">mapper</span><span class="p">(</span><span class="n">Project</span><span class="p">,</span> <span class="n">project_tbl</span><span class="p">,</span>
           <span class="n">id_attribute</span><span class="o">=</span><span class="s">&#39;project_id&#39;</span><span class="p">,</span> <span class="n">slug_expression</span><span class="o">=</span><span class="n">project_slug</span><span class="p">,</span>
           <span class="n">properties</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">customer</span><span class="o">=</span><span class="n">relationship</span><span class="p">(</span><span class="n">Customer</span><span class="p">,</span> <span class="n">uselist</span><span class="o">=</span><span class="bp">False</span><span class="p">)))</span>
    <span class="n">mapper</span><span class="p">(</span><span class="n">Site</span><span class="p">,</span> <span class="n">site_tbl</span><span class="p">,</span>
           <span class="n">id_attribute</span><span class="o">=</span><span class="s">&#39;site_id&#39;</span><span class="p">,</span> <span class="n">slug_expression</span><span class="o">=</span><span class="n">site_slug</span><span class="p">,</span>
           <span class="n">properties</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">project</span><span class="o">=</span><span class="n">relationship</span><span class="p">(</span><span class="n">Project</span><span class="p">,</span> <span class="n">uselist</span><span class="o">=</span><span class="bp">False</span><span class="p">)))</span>
    <span class="n">mapper</span><span class="p">(</span><span class="n">Species</span><span class="p">,</span> <span class="n">species_tbl</span><span class="p">,</span>
           <span class="n">id_attribute</span><span class="o">=</span><span class="s">&#39;species_id&#39;</span><span class="p">,</span> <span class="n">slug_expression</span><span class="o">=</span><span class="n">species_slug</span><span class="p">)</span>
    <span class="n">mapper</span><span class="p">(</span><span class="n">Incidence</span><span class="p">,</span> <span class="n">incidence_tbl</span><span class="p">,</span>
           <span class="n">slug_expression</span><span class="o">=</span><span class="n">incidence_slug</span><span class="p">,</span>
           <span class="n">properties</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">species</span><span class="o">=</span><span class="n">relationship</span><span class="p">(</span><span class="n">Species</span><span class="p">,</span> <span class="n">uselist</span><span class="o">=</span><span class="bp">False</span><span class="p">),</span>
                           <span class="n">site</span><span class="o">=</span><span class="n">relationship</span><span class="p">(</span><span class="n">Site</span><span class="p">,</span> <span class="n">uselist</span><span class="o">=</span><span class="bp">False</span><span class="p">)))</span>
    <span class="c"># Configure and initialize metadata.</span>
    <span class="n">metadata</span><span class="o">.</span><span class="n">bind</span> <span class="o">=</span> <span class="n">engine</span>
    <span class="n">metadata</span><span class="o">.</span><span class="n">create_all</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">metadata</span>
</pre></div>
</td></tr></table></div>
<p>The function first creates a database schema and then maps our entity classes to
this schema. Note that a special mapper is used which provides a convenient way
to map the special <cite>id</cite> and <cite>slug</cite> attributes required by <tt class="xref py py-mod docutils literal"><span class="pre">everest</span></tt> to the
ORM layer.</p>
<p>To use an engine other than the default in-memory SQLite database engine, you
need to supply a <tt class="docutils literal"><span class="pre">db_string</span></tt> setting in the paster application <tt class="docutils literal"><span class="pre">.ini</span></tt> file.
For example:</p>
<p>Note that while you can not have two default repositories, you could very well
have one or more <tt class="docutils literal"><span class="pre">filesystem_repository</span></tt> declarations for individual
resources, possibly even pointing to different directories in your file system.</p>
<p>Different resorces may use different repositories, but any given resource can
only be assigned to one repository.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Building <tt class="docutils literal"><span class="pre">everest</span></tt> applications</a><ul>
<li><a class="reference internal" href="#the-application">1. The application</a></li>
<li><a class="reference internal" href="#designing-the-entity-model">2. Designing the entity model</a></li>
<li><a class="reference internal" href="#designing-and-building-the-resource-layer">3. Designing and building the resource layer</a></li>
<li><a class="reference internal" href="#configuring-the-application">4. Configuring the application</a></li>
<li><a class="reference internal" href="#running-the-application">5. Running the application</a></li>
<li><a class="reference internal" href="#adding-persistency">6. Adding persistency</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="index.html"
                        title="previous chapter"><tt class="docutils literal"><span class="pre">everest</span></tt> Tutorial</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="using.html"
                        title="next chapter">Using <tt class="docutils literal"><span class="pre">everest</span></tt> applications</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/building.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="using.html" title="Using everest applications"
             >next</a> |</li>
        <li class="right" >
          <a href="index.html" title="everest Tutorial"
             >previous</a> |</li>
        <li><a href="index.html">everest demo 0.1 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright Copyright (c) 2011-2012 F. Oliver Gathmann, Cenix BioScience, Dresden, Germany .
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>